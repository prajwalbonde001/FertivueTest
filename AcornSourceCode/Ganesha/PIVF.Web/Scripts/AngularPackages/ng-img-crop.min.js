/*! ngImgCrop v0.3.2 License: MIT */
!function(){"use strict";var n=angular.module("ngImgCrop",[]);n.factory("cropAreaCircle",["cropArea",function(n){var t=function(){n.apply(this,arguments);this._boxResizeBaseSize=20;this._boxResizeNormalRatio=.9;this._boxResizeHoverRatio=1.2;this._iconMoveNormalRatio=.9;this._iconMoveHoverRatio=1.2;this._boxResizeNormalSize=this._boxResizeBaseSize*this._boxResizeNormalRatio;this._boxResizeHoverSize=this._boxResizeBaseSize*this._boxResizeHoverRatio;this._posDragStartX=0;this._posDragStartY=0;this._posResizeStartX=0;this._posResizeStartY=0;this._posResizeStartSize=0;this._boxResizeIsHover=!1;this._areaIsHover=!1;this._boxResizeIsDragging=!1;this._areaIsDragging=!1};return t.prototype=new n,t.prototype._calcCirclePerimeterCoords=function(n){var t=this._size/2,i=n*(Math.PI/180),r=this._x+t*Math.cos(i),u=this._y+t*Math.sin(i);return[r,u]},t.prototype._calcResizeIconCenterCoords=function(){return this._calcCirclePerimeterCoords(-45)},t.prototype._isCoordWithinArea=function(n){return Math.sqrt((n[0]-this._x)*(n[0]-this._x)+(n[1]-this._y)*(n[1]-this._y))<this._size/2},t.prototype._isCoordWithinBoxResize=function(n){var t=this._calcResizeIconCenterCoords(),i=this._boxResizeHoverSize/2;return n[0]>t[0]-i&&n[0]<t[0]+i&&n[1]>t[1]-i&&n[1]<t[1]+i},t.prototype._drawArea=function(n,t,i){n.arc(t[0],t[1],i/2,0,2*Math.PI)},t.prototype.draw=function(){n.prototype.draw.apply(this,arguments);this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);this._cropCanvas.drawIconResizeBoxNESW(this._calcResizeIconCenterCoords(),this._boxResizeBaseSize,this._boxResizeIsHover?this._boxResizeHoverRatio:this._boxResizeNormalRatio)},t.prototype.processMouseMove=function(n,t){var i="default",r=!1,e,u,f;return(this._boxResizeIsHover=!1,this._areaIsHover=!1,this._areaIsDragging)?(this._x=n-this._posDragStartX,this._y=t-this._posDragStartY,this._areaIsHover=!0,i="move",r=!0,this._events.trigger("area-move")):this._boxResizeIsDragging?(i="nesw-resize",u=n-this._posResizeStartX,f=this._posResizeStartY-t,e=u>f?this._posResizeStartSize+2*f:this._posResizeStartSize+2*u,this._size=Math.max(this._minSize,e),this._boxResizeIsHover=!0,r=!0,this._events.trigger("area-resize")):this._isCoordWithinBoxResize([n,t])?(i="nesw-resize",this._areaIsHover=!1,this._boxResizeIsHover=!0,r=!0):this._isCoordWithinArea([n,t])&&(i="move",this._areaIsHover=!0,r=!0),this._dontDragOutside(),angular.element(this._ctx.canvas).css({cursor:i}),r},t.prototype.processMouseDown=function(n,t){this._isCoordWithinBoxResize([n,t])?(this._areaIsDragging=!1,this._areaIsHover=!1,this._boxResizeIsDragging=!0,this._boxResizeIsHover=!0,this._posResizeStartX=n,this._posResizeStartY=t,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start")):this._isCoordWithinArea([n,t])&&(this._areaIsDragging=!0,this._areaIsHover=!0,this._boxResizeIsDragging=!1,this._boxResizeIsHover=!1,this._posDragStartX=n-this._x,this._posDragStartY=t-this._y,this._events.trigger("area-move-start"))},t.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end"));this._boxResizeIsDragging&&(this._boxResizeIsDragging=!1,this._events.trigger("area-resize-end"));this._areaIsHover=!1;this._boxResizeIsHover=!1;this._posDragStartX=0;this._posDragStartY=0},t}]);n.factory("cropAreaSquare",["cropArea",function(n){var t=function(){n.apply(this,arguments);this._resizeCtrlBaseRadius=10;this._resizeCtrlNormalRatio=.75;this._resizeCtrlHoverRatio=1;this._iconMoveNormalRatio=.9;this._iconMoveHoverRatio=1.2;this._resizeCtrlNormalRadius=this._resizeCtrlBaseRadius*this._resizeCtrlNormalRatio;this._resizeCtrlHoverRadius=this._resizeCtrlBaseRadius*this._resizeCtrlHoverRatio;this._posDragStartX=0;this._posDragStartY=0;this._posResizeStartX=0;this._posResizeStartY=0;this._posResizeStartSize=0;this._resizeCtrlIsHover=-1;this._areaIsHover=!1;this._resizeCtrlIsDragging=-1;this._areaIsDragging=!1};return t.prototype=new n,t.prototype._calcSquareCorners=function(){var n=this._size/2;return[[this._x-n,this._y-n],[this._x+n,this._y-n],[this._x-n,this._y+n],[this._x+n,this._y+n]]},t.prototype._calcSquareDimensions=function(){var n=this._size/2;return{left:this._x-n,top:this._y-n,right:this._x+n,bottom:this._y+n}},t.prototype._isCoordWithinArea=function(n){var t=this._calcSquareDimensions();return n[0]>=t.left&&n[0]<=t.right&&n[1]>=t.top&&n[1]<=t.bottom},t.prototype._isCoordWithinResizeCtrl=function(n){for(var t,r=this._calcSquareCorners(),u=-1,i=0,f=r.length;f>i;i++)if(t=r[i],n[0]>t[0]-this._resizeCtrlHoverRadius&&n[0]<t[0]+this._resizeCtrlHoverRadius&&n[1]>t[1]-this._resizeCtrlHoverRadius&&n[1]<t[1]+this._resizeCtrlHoverRadius){u=i;break}return u},t.prototype._drawArea=function(n,t,i){var r=i/2;n.rect(t[0]-r,t[1]-r,i,i)},t.prototype.draw=function(){var r;n.prototype.draw.apply(this,arguments);this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);for(var i=this._calcSquareCorners(),t=0,u=i.length;u>t;t++)r=i[t],this._cropCanvas.drawIconResizeCircle(r,this._resizeCtrlBaseRadius,this._resizeCtrlIsHover===t?this._resizeCtrlHoverRatio:this._resizeCtrlNormalRatio)},t.prototype.processMouseMove=function(n,t){var i="default",f=!1,r,u,c,o,s,l,h,e;if(this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._areaIsDragging)this._x=n-this._posDragStartX,this._y=t-this._posDragStartY,this._areaIsHover=!0,i="move",f=!0,this._events.trigger("area-move");else if(this._resizeCtrlIsDragging>-1){switch(this._resizeCtrlIsDragging){case 0:r=-1;u=-1;i="nwse-resize";break;case 1:r=1;u=-1;i="nesw-resize";break;case 2:r=-1;u=1;i="nesw-resize";break;case 3:r=1;u=1;i="nwse-resize"}o=(n-this._posResizeStartX)*r;s=(t-this._posResizeStartY)*u;c=o>s?this._posResizeStartSize+s:this._posResizeStartSize+o;l=this._size;this._size=Math.max(this._minSize,c);h=(this._size-l)/2;this._x+=h*r;this._y+=h*u;this._resizeCtrlIsHover=this._resizeCtrlIsDragging;f=!0;this._events.trigger("area-resize")}else if(e=this._isCoordWithinResizeCtrl([n,t]),e>-1){switch(e){case 0:i="nwse-resize";break;case 1:i="nesw-resize";break;case 2:i="nesw-resize";break;case 3:i="nwse-resize"}this._areaIsHover=!1;this._resizeCtrlIsHover=e;f=!0}else this._isCoordWithinArea([n,t])&&(i="move",this._areaIsHover=!0,f=!0);return this._dontDragOutside(),angular.element(this._ctx.canvas).css({cursor:i}),f},t.prototype.processMouseDown=function(n,t){var i=this._isCoordWithinResizeCtrl([n,t]);i>-1?(this._areaIsDragging=!1,this._areaIsHover=!1,this._resizeCtrlIsDragging=i,this._resizeCtrlIsHover=i,this._posResizeStartX=n,this._posResizeStartY=t,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start")):this._isCoordWithinArea([n,t])&&(this._areaIsDragging=!0,this._areaIsHover=!0,this._resizeCtrlIsDragging=-1,this._resizeCtrlIsHover=-1,this._posDragStartX=n-this._x,this._posDragStartY=t-this._y,this._events.trigger("area-move-start"))},t.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end"));this._resizeCtrlIsDragging>-1&&(this._resizeCtrlIsDragging=-1,this._events.trigger("area-resize-end"));this._areaIsHover=!1;this._resizeCtrlIsHover=-1;this._posDragStartX=0;this._posDragStartY=0},t}]);n.factory("cropArea",["cropCanvas",function(n){var t=function(t,i){this._ctx=t;this._events=i;this._minSize=80;this._cropCanvas=new n(t);this._image=new Image;this._x=0;this._y=0;this._size=200};return t.prototype.getImage=function(){return this._image},t.prototype.setImage=function(n){this._image=n},t.prototype.getX=function(){return this._x},t.prototype.setX=function(n){this._x=n;this._dontDragOutside()},t.prototype.getY=function(){return this._y},t.prototype.setY=function(n){this._y=n;this._dontDragOutside()},t.prototype.getSize=function(){return this._size},t.prototype.setSize=function(n){this._size=Math.max(this._minSize,n);this._dontDragOutside()},t.prototype.getMinSize=function(){return this._minSize},t.prototype.setMinSize=function(n){this._minSize=n;this._size=Math.max(this._minSize,this._size);this._dontDragOutside()},t.prototype._dontDragOutside=function(){var n=this._ctx.canvas.height,t=this._ctx.canvas.width;this._size>t&&(this._size=t);this._size>n&&(this._size=n);this._x<this._size/2&&(this._x=this._size/2);this._x>t-this._size/2&&(this._x=t-this._size/2);this._y<this._size/2&&(this._y=this._size/2);this._y>n-this._size/2&&(this._y=n-this._size/2)},t.prototype._drawArea=function(){},t.prototype.draw=function(){this._cropCanvas.drawCropArea(this._image,[this._x,this._y],this._size,this._drawArea)},t.prototype.processMouseMove=function(){},t.prototype.processMouseDown=function(){},t.prototype.processMouseUp=function(){},t}]);n.factory("cropCanvas",[function(){var t=[[-.5,-2],[-3,-4.5],[-.5,-7],[-7,-7],[-7,-.5],[-4.5,-3],[-2,-.5]],i=[[.5,-2],[3,-4.5],[.5,-7],[7,-7],[7,-.5],[4.5,-3],[2,-.5]],r=[[-.5,2],[-3,4.5],[-.5,7],[-7,7],[-7,.5],[-4.5,3],[-2,.5]],u=[[.5,2],[3,4.5],[.5,7],[7,7],[7,.5],[4.5,3],[2,.5]],f=[[-1.5,-2.5],[-1.5,-6],[-5,-6],[0,-11],[5,-6],[1.5,-6],[1.5,-2.5]],e=[[-2.5,-1.5],[-6,-1.5],[-6,-5],[-11,0],[-6,5],[-6,1.5],[-2.5,1.5]],o=[[-1.5,2.5],[-1.5,6],[-5,6],[0,11],[5,6],[1.5,6],[1.5,2.5]],s=[[2.5,-1.5],[6,-1.5],[6,-5],[11,0],[6,5],[6,1.5],[2.5,1.5]],n={areaOutline:"#fff",resizeBoxStroke:"#fff",resizeBoxFill:"#444",resizeBoxArrowFill:"#fff",resizeCircleStroke:"#fff",resizeCircleFill:"#444",moveIconFill:"#fff"};return function(h){var l=function(n,t,i){return[i*n[0]+t[0],i*n[1]+t[1]]},c=function(n,t,i,r){var f,u,e;h.save();h.fillStyle=t;h.beginPath();u=l(n[0],i,r);h.moveTo(u[0],u[1]);for(e in n)e>0&&(f=l(n[e],i,r),h.lineTo(f[0],f[1]));h.lineTo(u[0],u[1]);h.fill();h.closePath();h.restore()};this.drawIconMove=function(t,i){c(f,n.moveIconFill,t,i);c(e,n.moveIconFill,t,i);c(o,n.moveIconFill,t,i);c(s,n.moveIconFill,t,i)};this.drawIconResizeCircle=function(t,i,r){var u=i*r;h.save();h.strokeStyle=n.resizeCircleStroke;h.lineWidth=2;h.fillStyle=n.resizeCircleFill;h.beginPath();h.arc(t[0],t[1],u,0,2*Math.PI);h.fill();h.stroke();h.closePath();h.restore()};this.drawIconResizeBoxBase=function(t,i,r){var u=i*r;h.save();h.strokeStyle=n.resizeBoxStroke;h.lineWidth=2;h.fillStyle=n.resizeBoxFill;h.fillRect(t[0]-u/2,t[1]-u/2,u,u);h.strokeRect(t[0]-u/2,t[1]-u/2,u,u);h.restore()};this.drawIconResizeBoxNESW=function(t,u,f){this.drawIconResizeBoxBase(t,u,f);c(i,n.resizeBoxArrowFill,t,f);c(r,n.resizeBoxArrowFill,t,f)};this.drawIconResizeBoxNWSE=function(i,r,f){this.drawIconResizeBoxBase(i,r,f);c(t,n.resizeBoxArrowFill,i,f);c(u,n.resizeBoxArrowFill,i,f)};this.drawCropArea=function(t,i,r,u){var f=t.width/h.canvas.width,e=t.height/h.canvas.height,o=i[0]-r/2,s=i[1]-r/2;h.save();h.strokeStyle=n.areaOutline;h.lineWidth=2;h.beginPath();u(h,i,r);h.stroke();h.clip();r>0&&h.drawImage(t,o*f,s*e,r*f,r*e,o,s,r,r);h.beginPath();u(h,i,r);h.stroke();h.clip();h.restore()}}}]);n.service("cropEXIF",[function(){function i(n){return!!n.exifdata}function o(n,t){t=t||n.match(/^data\:([^\;]+)\;base64,/im)[1]||"";n=n.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var r=atob(n),u=r.length,f=new ArrayBuffer(u),e=new Uint8Array(f),i=0;u>i;i++)e[i]=r.charCodeAt(i);return f}function s(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0);i.responseType="blob";i.onload=function(){(200==this.status||0===this.status)&&t(this.response)};i.send()}function h(t,i){function e(n){var r=f(n),u=c(n);t.exifdata=r||{};t.iptcdata=u||{};i&&i.call(t)}var h,r,u;t.src?/^data\:/i.test(t.src)?(h=o(t.src),e(h)):/^blob\:/i.test(t.src)?(u=new FileReader,u.onload=function(n){e(n.target.result)},s(t.src,function(n){u.readAsArrayBuffer(n)})):(r=new XMLHttpRequest,r.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";e(r.response);r=null},r.open("GET",t.src,!0),r.responseType="arraybuffer",r.send(null)):window.FileReader&&(t instanceof window.Blob||t instanceof window.File)&&(u=new FileReader,u.onload=function(t){n&&console.log("Got file of length "+t.target.result.byteLength);e(t.target.result)},u.readAsArrayBuffer(t))}function f(t){var r=new DataView(t),u,i,f;if(n&&console.log("Got file of length "+t.byteLength),255!=r.getUint8(0)||216!=r.getUint8(1))return n&&console.log("Not a valid JPEG"),!1;for(i=2,f=t.byteLength;f>i;){if(255!=r.getUint8(i))return n&&console.log("Not a valid marker at offset "+i+", found: "+r.getUint8(i)),!1;if(u=r.getUint8(i+1),n&&console.log(u),225==u)return n&&console.log("Found 0xFFE1 marker"),v(r,i+4,r.getUint16(i+2)-2);i+=2+r.getUint16(i+2)}}function c(t){var u=new DataView(t),i,f,e;if(n&&console.log("Got file of length "+t.byteLength),255!=u.getUint8(0)||216!=u.getUint8(1))return n&&console.log("Not a valid JPEG"),!1;for(var r=2,o=t.byteLength,s=function(n,t){return 56===n.getUint8(t)&&66===n.getUint8(t+1)&&73===n.getUint8(t+2)&&77===n.getUint8(t+3)&&4===n.getUint8(t+4)&&4===n.getUint8(t+5)};o>r;){if(s(u,r))return i=u.getUint8(r+7),i%2!=0&&(i+=1),0===i&&(i=4),f=r+8+i,e=u.getUint16(r+6+i),l(t,f,e);r++}}function l(n,t,i){for(var h,u,c,l,a,s=new DataView(n),f={},o=t;t+i>o;)28===s.getUint8(o)&&2===s.getUint8(o+1)&&(l=s.getUint8(o+2),l in e&&(c=s.getInt16(o+3),a=c+5,u=e[l],h=r(s,o+5,c),f.hasOwnProperty(u)?f[u]instanceof Array?f[u].push(h):f[u]=[f[u],h]:f[u]=h)),o++;return f}function u(t,i,r,u,f){for(var e,s,c=t.getUint16(r,!f),h={},o=0;c>o;o++)e=r+12*o+2,s=u[t.getUint16(e,!f)],!s&&n&&console.log("Unknown tag: "+t.getUint16(e,!f)),h[s]=a(t,e,i,r,f);return h}function a(n,t,i,u,f){var c,o,v,e,l,a,y=n.getUint16(t+2,!f),s=n.getUint32(t+4,!f),h=n.getUint32(t+8,!f)+i;switch(y){case 1:case 7:if(1==s)return n.getUint8(t+8,!f);for(c=s>4?h:t+8,o=[],e=0;s>e;e++)o[e]=n.getUint8(c+e);return o;case 2:return c=s>4?h:t+8,r(n,c,s-1);case 3:if(1==s)return n.getUint16(t+8,!f);for(c=s>2?h:t+8,o=[],e=0;s>e;e++)o[e]=n.getUint16(c+2*e,!f);return o;case 4:if(1==s)return n.getUint32(t+8,!f);for(o=[],e=0;s>e;e++)o[e]=n.getUint32(h+4*e,!f);return o;case 5:if(1==s)return l=n.getUint32(h,!f),a=n.getUint32(h+4,!f),v=new Number(l/a),v.numerator=l,v.denominator=a,v;for(o=[],e=0;s>e;e++)l=n.getUint32(h+8*e,!f),a=n.getUint32(h+4+8*e,!f),o[e]=new Number(l/a),o[e].numerator=l,o[e].denominator=a;return o;case 9:if(1==s)return n.getInt32(t+8,!f);for(o=[],e=0;s>e;e++)o[e]=n.getInt32(h+4*e,!f);return o;case 10:if(1==s)return n.getInt32(h,!f)/n.getInt32(h+4,!f);for(o=[],e=0;s>e;e++)o[e]=n.getInt32(h+8*e,!f)/n.getInt32(h+4+8*e,!f);return o}}function r(n,t,i){for(var u="",r=t;t+i>r;r++)u+=String.fromCharCode(n.getUint8(r));return u}function v(i,f){var h,c,e,o,l,s,a;if("Exif"!=r(i,f,4))return n&&console.log("Not valid EXIF data! "+r(i,f,4)),!1;if(s=f+6,18761==i.getUint16(s))h=!1;else{if(19789!=i.getUint16(s))return n&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;h=!0}if(42!=i.getUint16(s+2,!h))return n&&console.log("Not valid TIFF data! (no 0x002A)"),!1;if(a=i.getUint32(s+4,!h),8>a)return n&&console.log("Not valid TIFF data! (First offset less than 8)",i.getUint32(s+4,!h)),!1;if(c=u(i,s,s+a,p,h),c.ExifIFDPointer){o=u(i,s,s+c.ExifIFDPointer,y,h);for(e in o){switch(e){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":o[e]=t[e][o[e]];break;case"ExifVersion":case"FlashpixVersion":o[e]=String.fromCharCode(o[e][0],o[e][1],o[e][2],o[e][3]);break;case"ComponentsConfiguration":o[e]=t.Components[o[e][0]]+t.Components[o[e][1]]+t.Components[o[e][2]]+t.Components[o[e][3]]}c[e]=o[e]}}if(c.GPSInfoIFDPointer){l=u(i,s,s+c.GPSInfoIFDPointer,w,h);for(e in l){switch(e){case"GPSVersionID":l[e]=l[e][0]+"."+l[e][1]+"."+l[e][2]+"."+l[e][3]}c[e]=l[e]}}return c}var n=!1,y=this.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},p=this.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},w=this.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},t=this.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},e={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};this.getData=function(n,t){return(n instanceof Image||n instanceof HTMLImageElement)&&!n.complete?!1:(i(n)?t&&t.call(n):h(n,t),!0)};this.getTag=function(n,t){if(i(n))return n.exifdata[t]};this.getAllTags=function(n){if(!i(n))return{};var t,r=n.exifdata,u={};for(t in r)r.hasOwnProperty(t)&&(u[t]=r[t]);return u};this.pretty=function(n){if(!i(n))return"";var t,r=n.exifdata,u="";for(t in r)r.hasOwnProperty(t)&&(u+="object"==typeof r[t]?r[t]instanceof Number?t+" : "+r[t]+" ["+r[t].numerator+"/"+r[t].denominator+"]\r\n":t+" : ["+r[t].length+" values]\r\n":t+" : "+r[t]+"\r\n");return u};this.readFromBinaryFile=function(n){return f(n)}}]);n.factory("cropHost",["$document","cropAreaCircle","cropAreaSquare","cropEXIF",function(n,t,i,r){var u=function(n){var r=n.getBoundingClientRect(),t=document.body,i=document.documentElement,u=window.pageYOffset||i.scrollTop||t.scrollTop,f=window.pageXOffset||i.scrollLeft||t.scrollLeft,e=i.clientTop||t.clientTop||0,o=i.clientLeft||t.clientLeft||0,s=r.top+u-e,h=r.left+f-o;return{top:Math.round(s),left:Math.round(h)}};return function(f,e,o){function v(){h.clearRect(0,0,h.canvas.width,h.canvas.height);null!==c&&(h.drawImage(c,0,0,h.canvas.width,h.canvas.height),h.save(),h.fillStyle="rgba(0, 0, 0, 0.65)",h.fillRect(0,0,h.canvas.width,h.canvas.height),h.restore(),s.draw())}var h=null,c=null,s=null,a=[100,100],l=[300,300],w=200,k="image/png",d=null,g=function(){if(null!==c){s.setImage(c);var i=[c.width,c.height],t=c.width/c.height,n=i;n[0]>l[0]?(n[0]=l[0],n[1]=n[0]/t):n[0]<a[0]&&(n[0]=a[0],n[1]=n[0]/t);n[1]>l[1]?(n[1]=l[1],n[0]=n[1]*t):n[1]<a[1]&&(n[1]=a[1],n[0]=n[1]*t);f.prop("width",n[0]).prop("height",n[1]).css({"margin-left":-n[0]/2+"px","margin-top":-n[1]/2+"px"});s.setX(h.canvas.width/2);s.setY(h.canvas.height/2);s.setSize(Math.min(200,h.canvas.width/2,h.canvas.height/2))}else f.prop("width",0).prop("height",0).css({"margin-top":0});v()},y=function(n){return angular.isDefined(n.changedTouches)?n.changedTouches:n.originalEvent.changedTouches},p=function(n){if(null!==c){var t,i,r=u(h.canvas);"touchmove"===n.type?(t=y(n)[0].pageX,i=y(n)[0].pageY):(t=n.pageX,i=n.pageY);s.processMouseMove(t-r.left,i-r.top);v()}},b=function(n){if(n.preventDefault(),n.stopPropagation(),null!==c){var t,i,r=u(h.canvas);"touchstart"===n.type?(t=y(n)[0].pageX,i=y(n)[0].pageY):(t=n.pageX,i=n.pageY);s.processMouseDown(t-r.left,i-r.top);v()}},nt=function(n){if(null!==c){var t,i,r=u(h.canvas);"touchend"===n.type?(t=y(n)[0].pageX,i=y(n)[0].pageY):(t=n.pageX,i=n.pageY);s.processMouseUp(t-r.left,i-r.top);v()}};this.getResultImageDataURI=function(){var t,n;return n=angular.element("<canvas><\/canvas>")[0],t=n.getContext("2d"),n.width=w,n.height=w,null!==c&&t.drawImage(c,(s.getX()-s.getSize()/2)*(c.width/h.canvas.width),(s.getY()-s.getSize()/2)*(c.height/h.canvas.height),s.getSize()*(c.width/h.canvas.width),s.getSize()*(c.height/h.canvas.height),0,0,w,w),null!==d?n.toDataURL(k,d):n.toDataURL(k)};this.setNewImageSource=function(n){if(c=null,g(),o.trigger("image-updated"),n){var t=new Image;"http"===n.substring(0,4).toLowerCase()&&(t.crossOrigin="anonymous");t.onload=function(){o.trigger("load-done");r.getData(t,function(){var h=r.getTag(t,"Orientation");if([3,6,8].indexOf(h)>-1){var n=document.createElement("canvas"),l=n.getContext("2d"),u=t.width,f=t.height,e=0,s=0,i=0;switch(h){case 3:e=-t.width;s=-t.height;i=180;break;case 6:u=t.height;f=t.width;s=-t.height;i=90;break;case 8:u=t.height;f=t.width;e=-t.width;i=270}n.width=u;n.height=f;l.rotate(i*Math.PI/180);l.drawImage(t,e,s);c=new Image;c.src=n.toDataURL("image/png")}else c=t;g();o.trigger("image-updated")})};t.onerror=function(){o.trigger("load-error")};o.trigger("load-start");t.src=n}};this.setMaxDimensions=function(n,t){if(l=[n,t],null!==c){var o=h.canvas.width,y=h.canvas.height,p=[c.width,c.height],r=c.width/c.height,i=p;i[0]>l[0]?(i[0]=l[0],i[1]=i[0]/r):i[0]<a[0]&&(i[0]=a[0],i[1]=i[0]/r);i[1]>l[1]?(i[1]=l[1],i[0]=i[1]*r):i[1]<a[1]&&(i[1]=a[1],i[0]=i[1]*r);f.prop("width",i[0]).prop("height",i[1]).css({"margin-left":-i[0]/2+"px","margin-top":-i[1]/2+"px"});var u=h.canvas.width/o,e=h.canvas.height/y,w=Math.min(u,e);s.setX(s.getX()*u);s.setY(s.getY()*e);s.setSize(s.getSize()*w)}else f.prop("width",0).prop("height",0).css({"margin-top":0});v()};this.setAreaMinSize=function(n){n=parseInt(n,10);isNaN(n)||(s.setMinSize(n),v())};this.setResultImageSize=function(n){n=parseInt(n,10);isNaN(n)||(w=n)};this.setResultImageFormat=function(n){k=n};this.setResultImageQuality=function(n){n=parseFloat(n);!isNaN(n)&&n>=0&&1>=n&&(d=n)};this.setAreaType=function(n){var u=s.getSize(),f=s.getMinSize(),e=s.getX(),l=s.getY(),r=t;"square"===n&&(r=i);s=new r(h,o);s.setMinSize(f);s.setSize(u);s.setX(e);s.setY(l);null!==c&&s.setImage(c);v()};h=f[0].getContext("2d");s=new t(h,o);n.on("mousemove",p);f.on("mousedown",b);n.on("mouseup",nt);n.on("touchmove",p);f.on("touchstart",b);n.on("touchend",nt);this.destroy=function(){n.off("mousemove",p);f.off("mousedown",b);n.off("mouseup",p);n.off("touchmove",p);f.off("touchstart",b);n.off("touchend",p);f.remove()}}}]);n.factory("cropPubSub",[function(){return function(){var n={};this.on=function(t,i){return t.split(" ").forEach(function(t){n[t]||(n[t]=[]);n[t].push(i)}),this};this.trigger=function(t,i){return angular.forEach(n[t],function(n){n.call(null,i)}),this}}}]);n.directive("imgCrop",["$timeout","cropHost","cropPubSub",function(n,t,i){return{restrict:"E",scope:{image:"=",resultImage:"=",changeOnFly:"=",areaType:"@",areaMinSize:"=",resultImageSize:"=",resultImageFormat:"@",resultImageQuality:"=",onChange:"&",onLoadBegin:"&",onLoadDone:"&",onLoadError:"&"},template:"<canvas><\/canvas>",controller:["$scope",function(n){n.events=new i}],link:function(i,r){var o,s=i.events,u=new t(r.find("canvas"),{},s),f=function(n){var t=u.getResultImageDataURI();o!==t&&(o=t,angular.isDefined(n.resultImage)&&(n.resultImage=t),n.onChange({$dataURI:n.resultImage}))},e=function(t){return function(){n(function(){i.$apply(function(n){t(n)})})}};s.on("load-start",e(function(n){n.onLoadBegin({})})).on("load-done",e(function(n){n.onLoadDone({})})).on("load-error",e(function(n){n.onLoadError({})})).on("area-move area-resize",e(function(n){n.changeOnFly&&f(n)})).on("area-move-end area-resize-end image-updated",e(function(n){f(n)}));i.$watch("image",function(){u.setNewImageSource(i.image)});i.$watch("areaType",function(){u.setAreaType(i.areaType);f(i)});i.$watch("areaMinSize",function(){u.setAreaMinSize(i.areaMinSize);f(i)});i.$watch("resultImageSize",function(){u.setResultImageSize(i.resultImageSize);f(i)});i.$watch("resultImageFormat",function(){u.setResultImageFormat(i.resultImageFormat);f(i)});i.$watch("resultImageQuality",function(){u.setResultImageQuality(i.resultImageQuality);f(i)});i.$watch(function(){return[r[0].clientWidth,r[0].clientHeight]},function(n){u.setMaxDimensions(n[0],n[1]);f(i)},!0);i.$on("$destroy",function(){u.destroy()})}}}])}();